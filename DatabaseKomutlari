CREATE DATABASE E_Ticaret;
GO

USE E_Ticaret;
GO

CREATE TABLE Users (
    ID INT PRIMARY KEY IDENTITY(1,1),
    Username VARCHAR(255) NOT NULL,
    Password VARCHAR(255) NOT NULL,
    NameSurname VARCHAR(255) NOT NULL,
    Email VARCHAR(255),
    Gender VARCHAR(10),
    BirthDate DATE,
    CreatedDate DATETIME DEFAULT GETDATE(),
    TelNr1 VARCHAR(15),
    TelNr2 VARCHAR(15)
);

CREATE TABLE Countries (
    ID INT PRIMARY KEY IDENTITY(1,1),
    Country VARCHAR(255) NOT NULL
);

CREATE TABLE Cities (
    ID INT PRIMARY KEY IDENTITY(1,1),
    CountryID INT,
    City VARCHAR(255) NOT NULL,
    FOREIGN KEY (CountryID) REFERENCES Countries(ID)
);

CREATE TABLE Towns (
    ID INT PRIMARY KEY IDENTITY(1,1),
    CityID INT,
    Town VARCHAR(255) NOT NULL,
    FOREIGN KEY (CityID) REFERENCES Cities(ID)
);

CREATE TABLE Districts (
    ID INT PRIMARY KEY IDENTITY(1,1),
    TownID INT,
    District VARCHAR(255) NOT NULL,
    FOREIGN KEY (TownID) REFERENCES Towns(ID)
);

CREATE TABLE Address (
    ID INT PRIMARY KEY IDENTITY(1,1),
    UserID INT,
    CountryID INT,
    CityID INT,
    TownID INT,
    DistrictID INT,
    PostalCode VARCHAR(15),
    AddressText TEXT,
    FOREIGN KEY (UserID) REFERENCES Users(ID),
    FOREIGN KEY (CountryID) REFERENCES Countries(ID),
    FOREIGN KEY (CityID) REFERENCES Cities(ID),
    FOREIGN KEY (TownID) REFERENCES Towns(ID),
    FOREIGN KEY (DistrictID) REFERENCES Districts(ID)
);

CREATE TABLE Orders (
    ID INT PRIMARY KEY IDENTITY(1,1),
    UserID INT,
    Date DATE NOT NULL,
    TotalPrice DECIMAL(10, 2),
    Status VARCHAR(50),
    AddressID INT,
    FOREIGN KEY (UserID) REFERENCES Users(ID),
    FOREIGN KEY (AddressID) REFERENCES Address(ID)
);

CREATE TABLE Items (
    ID INT PRIMARY KEY IDENTITY(1,1),
    ItemCode VARCHAR(50),
    ItemName VARCHAR(255),
    UnitPrice DECIMAL(10, 2),
    Category1 VARCHAR(100),
    Category2 VARCHAR(100),
    Category3 VARCHAR(100),
    Category4 VARCHAR(100),
    Brand VARCHAR(100)
);

CREATE TABLE OrderDetails (
    ID INT PRIMARY KEY IDENTITY(1,1),
    OrderID INT,
    ItemID INT,
    Amount INT NOT NULL,
    UnitPrice DECIMAL(10, 2),
    LineTotal DECIMAL(10, 2),
    FOREIGN KEY (OrderID) REFERENCES Orders(ID),
    FOREIGN KEY (ItemID) REFERENCES Items(ID)
);

CREATE TABLE Invoices (
    ID INT PRIMARY KEY IDENTITY(1,1),
    OrderID INT,
    Date DATE NOT NULL,
    AddressID INT,
    CargoFicheno VARCHAR(50),
    TotalPrice DECIMAL(10, 2),
    FOREIGN KEY (OrderID) REFERENCES Orders(ID),
    FOREIGN KEY (AddressID) REFERENCES Address(ID)
);

CREATE TABLE InvoiceDetails (
    ID INT PRIMARY KEY IDENTITY(1,1),
    InvoiceID INT,
    OrderDetailID INT,
    ItemID INT,
    Amount INT NOT NULL,
    UnitPrice DECIMAL(10, 2),
    LineTotal DECIMAL(10, 2),
    FOREIGN KEY (InvoiceID) REFERENCES Invoices(ID),
    FOREIGN KEY (OrderDetailID) REFERENCES OrderDetails(ID),
    FOREIGN KEY (ItemID) REFERENCES Items(ID)
);

CREATE TABLE Payments (
    ID INT PRIMARY KEY IDENTITY(1,1),
    OrderID INT,
    PaymentType VARCHAR(50),
    Date DATE NOT NULL,
    IsOK BIT,
    ApprovalCode VARCHAR(100),
    PaymentTotal DECIMAL(10, 2),
    FOREIGN KEY (OrderID) REFERENCES Orders(ID)
);
